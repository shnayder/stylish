<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Writing Style Explorer</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/components.css">
  <link rel="stylesheet" href="styles/modal.css">
  <link rel="stylesheet" href="styles/rewrite.css">
</head>
<body>
  <!-- Settings toggle button -->
  <button class="settings-toggle" id="settings-toggle">Settings</button>

  <!-- Stats toggle button -->
  <button class="stats-toggle" id="stats-toggle">Stats</button>

  <!-- Stats panel -->
  <div class="stats-panel" id="stats-panel">
    <h3>LLM Usage Stats</h3>
    <div class="stats-summary">
      <div class="stat-item">
        <span class="stat-label">Total Calls</span>
        <span class="stat-value" id="stat-calls">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Input Tokens</span>
        <span class="stat-value" id="stat-input-tokens">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Output Tokens</span>
        <span class="stat-value" id="stat-output-tokens">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Total Tokens</span>
        <span class="stat-value" id="stat-total-tokens">0</span>
      </div>
    </div>
    <div class="stats-costs">
      <h4>Estimated API Costs</h4>
      <div class="cost-grid" id="cost-grid"></div>
    </div>
    <div class="stats-actions">
      <button class="action-btn" id="reset-stats">Reset Stats</button>
    </div>
  </div>

  <!-- Settings panel -->
  <div class="settings-panel" id="settings-panel">
    <h3>LLM Configuration</h3>
    <div class="settings-status" id="settings-status" style="display: none;"></div>

    <div class="settings-group">
      <label>Provider</label>
      <div class="radio-group">
        <label>
          <input type="radio" name="provider" value="local" checked>
          Local (LM Studio)
        </label>
        <label>
          <input type="radio" name="provider" value="anthropic">
          Claude API
        </label>
      </div>
    </div>

    <div class="settings-group" id="local-settings">
      <label for="local-url">Local API URL</label>
      <input type="text" id="local-url" value="http://localhost:1234" placeholder="http://localhost:1234">
      <div class="hint">LM Studio default: http://localhost:1234</div>
    </div>

    <div class="settings-group" id="anthropic-settings" style="display: none;">
      <label for="anthropic-key">Anthropic API Key</label>
      <input type="password" id="anthropic-key" placeholder="sk-ant-...">
      <div class="hint">Stored in localStorage (browser only)</div>
    </div>

    <div class="settings-actions">
      <button class="action-btn primary" id="test-connection">Test Connection</button>
      <button class="action-btn" id="save-settings">Save</button>
    </div>

    <div class="settings-group">
      <label>Data Management</label>
      <div class="settings-actions">
        <button class="action-btn" id="export-data">Export</button>
        <button class="action-btn" id="import-data">Import</button>
      </div>
    </div>
  </div>

  <div class="container">
    <h1>Writing Style Explorer</h1>

    <div class="input-section">
      <div class="pane">
        <h2>What I'm Describing</h2>
        <textarea id="setting-input" placeholder="Describe your setting...

Example:
Setting: Rivendell, the Last Homely House

Known details:
- Hidden valley in the Misty Mountains
- Elven refuge founded by Elrond
- Waterfalls, pine trees, ancient stone buildings
- A place of rest, learning, and healing

Context: First arrival of weary travelers seeking sanctuary">Setting: Rivendell, the Last Homely House

Known details:
- Hidden valley in the Misty Mountains
- Elven refuge founded by Elrond
- Waterfalls, pine trees, ancient stone buildings
- A place of rest, learning, and healing
- Twilight atmosphere, stars visible even at dusk

Context: First arrival of weary travelers seeking sanctuary</textarea>
      </div>

      <div class="pane">
        <h2>General Style</h2>
        <textarea id="style-input" placeholder="Style rules that apply to your whole project...

Example:
- First person POV
- Past tense
- Spare, grounded prose
- Avoid adverbs
- Show don't tell">- First person POV from Bilbo
- Past tense
- Spare, grounded prose style
- Avoid purple prose or overly ornate language
- Show don't tell</textarea>
      </div>
    </div>

    <div class="input-section" style="margin-top: -10px;">
      <div class="pane" style="grid-column: 1 / -1;">
        <h2>This Scene</h2>
        <textarea id="scene-input" placeholder="What this specific scene should accomplish...

Example:
- Build tension before the reveal
- Convey exhaustion and relief
- Foreshadow the danger ahead">- Convey sense of relief and safety after danger
- Show the otherworldly, timeless quality of the Elves
- Use sensory details beyond just visual
- Length: 2-3 paragraphs</textarea>
      </div>
    </div>

    <!-- Style Guide Section -->
    <div class="style-guide" id="style-guide">
      <div class="style-guide-header" id="style-guide-header">
        <h2>Style Guide <span class="rule-count" id="rule-count"></span></h2>
        <span class="toggle-icon" id="toggle-icon">expand</span>
      </div>
      <div class="style-guide-content" id="style-guide-content">
        <p class="empty-message">No style rules yet. Select text in alternatives and drill down to crystallize your preferences.</p>
        <div class="rules-list" id="rules-list"></div>
      </div>
    </div>

    <div class="alternatives-header">
      <h2>Alternatives</h2>
      <button class="regenerate-btn">Generate More</button>
    </div>

    <div class="alternatives-grid" id="alternatives">
    </div>

    <div class="style-palette" id="style-palette">
      <div class="style-palette-header">
        <h2>Style Properties</h2>
        <span class="selection-count" id="style-selection-count"></span>
      </div>
      <div class="style-categories" id="style-categories">
      </div>
      <div class="panel-actions">
        <button class="action-btn primary" id="generate-from-styles" disabled>Generate with Selected Styles</button>
        <button class="action-btn clear-styles-btn" id="clear-styles" disabled>Clear Selection</button>
      </div>
    </div>

    <div class="reactions-panel" id="reactions-panel">
      <h2>My Reactions</h2>
      <div class="all-reactions" id="all-reactions">
        <p class="empty-state">Select text or add reactions to alternatives to collect your thoughts here.</p>
      </div>
      <div class="panel-actions">
        <button class="action-btn" id="apply-to-guidance" disabled>Apply to Guidance</button>
        <button class="action-btn primary" id="generate-with-reactions" disabled>Generate New Version</button>
      </div>
    </div>
  </div>

  <!-- Selection popup (hidden by default) -->
  <div class="selection-popup" id="selection-popup">
    <div class="selected-text" id="popup-selected-text"></div>
    <textarea id="popup-reaction-input" placeholder="What do you think about this?"></textarea>
    <div class="popup-actions">
      <button class="action-btn" id="popup-cancel">Cancel</button>
      <button class="action-btn" id="popup-drill-down">Drill Down</button>
      <button class="action-btn" id="popup-rewrite">Rewrite This</button>
      <button class="action-btn primary" id="popup-save">Add Reaction</button>
    </div>
  </div>

  <!-- Drill-down modal -->
  <div class="modal-overlay" id="drill-down-overlay">
    <div class="drill-down-modal">
      <div class="modal-header">
        <h3>Exploring Style</h3>
        <button class="close-modal" id="close-drill-down">&times;</button>
      </div>
      <div class="modal-body">
        <div class="selected-text-box" id="modal-selected-text"></div>
        <div class="initial-reaction-box">
          <label>Your initial reaction</label>
          <div id="modal-initial-reaction"></div>
        </div>
        <div class="conversation-area">
          <div class="conversation-messages" id="conversation-messages">
          </div>
        </div>
        <div class="conversation-input">
          <textarea id="coach-input" placeholder="Type your response..."></textarea>
          <button class="action-btn primary" id="send-to-coach">Send</button>
        </div>
        <div class="proposed-rule" id="proposed-rule">
          <h4>Proposed Style Rule</h4>
          <div class="rule-preview" id="rule-preview">
            <div class="principle" id="preview-principle"></div>
            <div class="examples" id="preview-examples"></div>
          </div>
          <textarea id="rule-edit-area" placeholder="Edit the rule..."></textarea>
          <div style="display: flex; gap: 10px;">
            <button class="action-btn" id="edit-rule-btn">Edit</button>
            <button class="action-btn" id="save-rule-edit" style="display: none;">Done Editing</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="action-btn" id="keep-exploring">Keep Exploring</button>
        <button class="action-btn primary" id="add-to-style-guide" disabled>Add to Style Guide</button>
      </div>
    </div>
  </div>

  <!-- Rewrite View (full page, hidden by default) -->
  <div class="rewrite-view" id="rewrite-view">
    <div class="rewrite-header">
      <button class="action-btn" id="rewrite-back">&larr; Back to Main</button>
      <button class="action-btn primary" id="rewrite-replace">Replace Original</button>
    </div>

    <div class="rewrite-content">
      <!-- Context and Current Sentence -->
      <div class="rewrite-context-section">
        <div class="context-before" id="context-before"></div>
        <div class="current-sentence-wrapper">
          <label>Current Sentence</label>
          <textarea id="current-sentence" class="current-sentence"></textarea>
        </div>
        <div class="context-after" id="context-after"></div>
      </div>

      <!-- Directions to Explore -->
      <div class="rewrite-directions-section">
        <h3>Directions to Explore</h3>
        <div class="active-directions" id="active-directions"></div>
        <div class="more-directions-wrapper">
          <button class="action-btn toggle-more-directions" id="toggle-more-directions">Show more directions</button>
          <div class="more-directions" id="more-directions"></div>
        </div>
      </div>

      <!-- Variations Grid -->
      <div class="rewrite-variations-section">
        <div class="variations-header">
          <h3>Variations</h3>
          <button class="action-btn primary" id="generate-more-variations">Generate More</button>
        </div>
        <div class="variations-by-direction" id="variations-by-direction"></div>
      </div>

      <!-- Consideration Set -->
      <div class="rewrite-consideration-section">
        <h3>Consideration Set <span class="consideration-count" id="consideration-count"></span></h3>
        <div class="consideration-empty" id="consideration-empty">
          Add variations you like here to compare them
        </div>
        <div class="consideration-list" id="consideration-list"></div>
      </div>

      <!-- Feedback Log -->
      <div class="feedback-log-section">
        <div class="feedback-log-header" id="feedback-log-header">
          <h3>Feedback Log <span class="feedback-count" id="feedback-count"></span></h3>
          <button class="toggle-feedback-log" id="toggle-feedback-log">Expand</button>
        </div>
        <div class="feedback-log-content" id="feedback-log-content">
          <div class="feedback-log-empty" id="feedback-log-empty">
            Vote on variations or add annotations to build your feedback log
          </div>
          <div class="feedback-log-list" id="feedback-log-list"></div>
          <div class="feedback-log-actions" id="feedback-log-actions">
            <button class="action-btn" id="clear-feedback">Clear All</button>
            <button class="action-btn primary" id="synthesize-rules">Synthesize Rules</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Synthesis Modal -->
  <div class="modal-overlay" id="synthesis-overlay">
    <div class="synthesis-modal">
      <div class="modal-header">
        <h3>Synthesize Feedback into Style Rules</h3>
        <button class="close-modal" id="close-synthesis">&times;</button>
      </div>
      <div class="modal-body">
        <div class="synthesis-loading" id="synthesis-loading">
          <div class="synthesis-spinner"></div>
          <p>Analyzing your feedback...</p>
        </div>
        <div class="synthesis-results" id="synthesis-results"></div>
      </div>
      <div class="modal-footer">
        <button class="action-btn" id="cancel-synthesis">Cancel</button>
        <button class="action-btn primary" id="apply-synthesis" disabled>Add Selected to Style Guide</button>
      </div>
    </div>
  </div>

  <script type="module" src="src/main.js"></script>
</body>
</html>
