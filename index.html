<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Writing Style Explorer</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/components.css">
  <link rel="stylesheet" href="styles/modal.css">
</head>
<body>
  <!-- Settings toggle button -->
  <button class="settings-toggle" id="settings-toggle">Settings</button>

  <!-- Settings panel -->
  <div class="settings-panel" id="settings-panel">
    <h3>LLM Configuration</h3>
    <div class="settings-status" id="settings-status" style="display: none;"></div>

    <div class="settings-group">
      <label>Provider</label>
      <div class="radio-group">
        <label>
          <input type="radio" name="provider" value="local" checked>
          Local (LM Studio)
        </label>
        <label>
          <input type="radio" name="provider" value="anthropic">
          Claude API
        </label>
      </div>
    </div>

    <div class="settings-group" id="local-settings">
      <label for="local-url">Local API URL</label>
      <input type="text" id="local-url" value="http://localhost:1234" placeholder="http://localhost:1234">
      <div class="hint">LM Studio default: http://localhost:1234</div>
    </div>

    <div class="settings-group" id="anthropic-settings" style="display: none;">
      <label for="anthropic-key">Anthropic API Key</label>
      <input type="password" id="anthropic-key" placeholder="sk-ant-...">
      <div class="hint">Stored in localStorage (browser only)</div>
    </div>

    <div class="settings-actions">
      <button class="action-btn primary" id="test-connection">Test Connection</button>
      <button class="action-btn" id="save-settings">Save</button>
    </div>

    <div class="settings-group">
      <label>Data Management</label>
      <div class="settings-actions">
        <button class="action-btn" id="export-data">Export</button>
        <button class="action-btn" id="import-data">Import</button>
      </div>
    </div>
  </div>

  <div class="container">
    <h1>Writing Style Explorer</h1>

    <div class="input-section">
      <div class="pane">
        <h2>What I'm Describing</h2>
        <textarea id="setting-input" placeholder="Describe your setting...

Example:
Setting: Rivendell, the Last Homely House

Known details:
- Hidden valley in the Misty Mountains
- Elven refuge founded by Elrond
- Waterfalls, pine trees, ancient stone buildings
- A place of rest, learning, and healing

Context: First arrival of weary travelers seeking sanctuary">Setting: Rivendell, the Last Homely House

Known details:
- Hidden valley in the Misty Mountains
- Elven refuge founded by Elrond
- Waterfalls, pine trees, ancient stone buildings
- A place of rest, learning, and healing
- Twilight atmosphere, stars visible even at dusk

Context: First arrival of weary travelers seeking sanctuary</textarea>
      </div>

      <div class="pane">
        <h2>General Style</h2>
        <textarea id="style-input" placeholder="Style rules that apply to your whole project...

Example:
- First person POV
- Past tense
- Spare, grounded prose
- Avoid adverbs
- Show don't tell">- First person POV from Bilbo
- Past tense
- Spare, grounded prose style
- Avoid purple prose or overly ornate language
- Show don't tell</textarea>
      </div>
    </div>

    <div class="input-section" style="margin-top: -10px;">
      <div class="pane" style="grid-column: 1 / -1;">
        <h2>This Scene</h2>
        <textarea id="scene-input" placeholder="What this specific scene should accomplish...

Example:
- Build tension before the reveal
- Convey exhaustion and relief
- Foreshadow the danger ahead">- Convey sense of relief and safety after danger
- Show the otherworldly, timeless quality of the Elves
- Use sensory details beyond just visual
- Length: 2-3 paragraphs</textarea>
      </div>
    </div>

    <!-- Style Guide Section -->
    <div class="style-guide" id="style-guide">
      <div class="style-guide-header" id="style-guide-header">
        <h2>Style Guide <span class="rule-count" id="rule-count"></span></h2>
        <span class="toggle-icon" id="toggle-icon">expand</span>
      </div>
      <div class="style-guide-content" id="style-guide-content">
        <p class="empty-message">No style rules yet. Select text in alternatives and drill down to crystallize your preferences.</p>
        <div class="rules-list" id="rules-list"></div>
      </div>
    </div>

    <div class="alternatives-header">
      <h2>Alternatives</h2>
      <button class="regenerate-btn">Generate More</button>
    </div>

    <div class="alternatives-grid" id="alternatives">
    </div>

    <div class="style-palette" id="style-palette">
      <div class="style-palette-header">
        <h2>Style Properties</h2>
        <span class="selection-count" id="style-selection-count"></span>
      </div>
      <div class="style-categories" id="style-categories">
      </div>
      <div class="panel-actions">
        <button class="action-btn primary" id="generate-from-styles" disabled>Generate with Selected Styles</button>
        <button class="action-btn clear-styles-btn" id="clear-styles" disabled>Clear Selection</button>
      </div>
    </div>

    <div class="reactions-panel" id="reactions-panel">
      <h2>My Reactions</h2>
      <div class="all-reactions" id="all-reactions">
        <p class="empty-state">Select text or add reactions to alternatives to collect your thoughts here.</p>
      </div>
      <div class="panel-actions">
        <button class="action-btn" id="apply-to-guidance" disabled>Apply to Guidance</button>
        <button class="action-btn primary" id="generate-with-reactions" disabled>Generate New Version</button>
      </div>
    </div>
  </div>

  <!-- Selection popup (hidden by default) -->
  <div class="selection-popup" id="selection-popup">
    <div class="selected-text" id="popup-selected-text"></div>
    <textarea id="popup-reaction-input" placeholder="What do you think about this?"></textarea>
    <div class="popup-actions">
      <button class="action-btn" id="popup-cancel">Cancel</button>
      <button class="action-btn" id="popup-drill-down">Drill Down</button>
      <button class="action-btn primary" id="popup-save">Add Reaction</button>
    </div>
  </div>

  <!-- Drill-down modal -->
  <div class="modal-overlay" id="drill-down-overlay">
    <div class="drill-down-modal">
      <div class="modal-header">
        <h3>Exploring Style</h3>
        <button class="close-modal" id="close-drill-down">&times;</button>
      </div>
      <div class="modal-body">
        <div class="selected-text-box" id="modal-selected-text"></div>
        <div class="initial-reaction-box">
          <label>Your initial reaction</label>
          <div id="modal-initial-reaction"></div>
        </div>
        <div class="conversation-area">
          <div class="conversation-messages" id="conversation-messages">
          </div>
        </div>
        <div class="conversation-input">
          <textarea id="coach-input" placeholder="Type your response..."></textarea>
          <button class="action-btn primary" id="send-to-coach">Send</button>
        </div>
        <div class="proposed-rule" id="proposed-rule">
          <h4>Proposed Style Rule</h4>
          <div class="rule-preview" id="rule-preview">
            <div class="principle" id="preview-principle"></div>
            <div class="examples" id="preview-examples"></div>
          </div>
          <textarea id="rule-edit-area" placeholder="Edit the rule..."></textarea>
          <div style="display: flex; gap: 10px;">
            <button class="action-btn" id="edit-rule-btn">Edit</button>
            <button class="action-btn" id="save-rule-edit" style="display: none;">Done Editing</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="action-btn" id="keep-exploring">Keep Exploring</button>
        <button class="action-btn primary" id="add-to-style-guide" disabled>Add to Style Guide</button>
      </div>
    </div>
  </div>

  <script type="module" src="src/main.js"></script>
</body>
</html>
